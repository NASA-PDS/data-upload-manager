

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>📦 Installation &mdash; PDS Data Upload Manager  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="👩‍💻 Development" href="../development/index.html" />
    <link rel="prev" title="PDS Data Upload Manager" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> PDS Data Upload Manager
          

          
            
            <img src="../_static/PDS_Planets.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">📦 Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-instructions">Installation Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client-configuration">Client Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-client-script">Running the Client script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#upgrading-the-service">Upgrading the Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-server-side-bucket-map">Configuring the Server side Bucket Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-users-to-the-aws-cognito-user-pool">Adding users to the AWS Cognito User Pool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">👩‍💻 Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">🏃‍ ️Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/index.html">Deployment Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/index.html#creating-the-deployment-tfvars-file">Creating the deployment .tfvars file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/index.html#deploying-the-terraform">Deploying the Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/index.html#utilizing-terraform-outputs">Utilizing Terraform Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/index.html#destroying-a-deployment">Destroying a Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">️Command Line API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/contact.html">Contact Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/contribute.html#report-a-bug-or-new-feature-request">Report a Bug or New Feature Request</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/help.html">Help</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PDS Data Upload Manager</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>📦 Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/nasa-pds/template-repo-python/blob/main/docs/source/installation/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>📦 Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to install the PDS Data Upload Manager (DUM) Service.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>Prior to installing this software, ensure your system meets the following
requirements:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.python.org/">Python</a> 3.9 or above. Python 2 is <em>not</em> supported.</p></li>
<li><p><a href="#id3"><span class="problematic" id="id4">Terraform_</span></a> 1.0.11 or above. Note that Terraform is only required when deploying
the server side components. It is not required to run the client-side script.
For more information on deploying the server side components via Terraform,
consult the <a href="#id5"><span class="problematic" id="id6">terraform_</span></a> section of the documentation.</p></li>
</ul>
<p>Consult your operating system instructions or system administrator to install
the required packages. For those without system administrator access, you
can use a local <a class="reference external" href="https://www.python.org/">Python</a> 3 installation using a <a class="reference external" href="https://docs.python.org/3/library/venv.html">virtual environment</a>
installation.</p>
</div>
<div class="section" id="installation-instructions">
<h2>Installation Instructions<a class="headerlink" href="#installation-instructions" title="Permalink to this headline">¶</a></h2>
<p>This section documents the installation procedure.</p>
<div class="section" id="id1">
<h3>Installation<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to install this software is to use <a class="reference external" href="https://pip.pypa.io/en/stable/">Pip</a>, the Python Package
Installer. If you have Python on your system, you probably already have Pip;
you can run <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">--help</span></code> to check. Then run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="n">pds</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">upload</span><span class="o">-</span><span class="n">manager</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above command will install the latest approved release.
To install a prior release, you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="n">pds</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">upload</span><span class="o">-</span><span class="n">manager</span><span class="o">==&lt;</span><span class="n">version</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The released versions are listed on <a class="reference external" href="https://pypi.org/project/pds-data-upload-manager/#history">https://pypi.org/project/pds-data-upload-manager/#history</a></p>
<p>If you want to use the latest unstable version, refer to the <a class="reference external" href="../development/index.html">development</a> documentation</p>
</div>
<p>If you don’t want the package dependencies to interfere with your local system
you can use a <a class="reference external" href="https://docs.python.org/3/library/venv.html">virtual environment</a>  for your deployment.
To do so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir -p $HOME/.venv
python3 -m venv $HOME/.venv/pds-data-upload-manager
source $HOME/.venv/pds-data-upload-manager/bin/activate
pip3 install pds-data-upload-manager
</pre></div>
</div>
<p>At this point, the PDS DUM client script is available under
<code class="docutils literal notranslate"><span class="pre">$HOME/.venv/pds-data-upload-manager/bin/pds-ingress-client</span></code>.</p>
</div>
<div class="section" id="client-configuration">
<h3>Client Configuration<a class="headerlink" href="#client-configuration" title="Permalink to this headline">¶</a></h3>
<p>The PDS DUM client script utilizes an <a class="reference external" href="https://en.wikipedia.org/wiki/INI_file">INI</a> file for its configuration. While there
is a default configuration file bundled with the service, to properly communicate
with the server side components within AWS, end-users must provide their own
INI configuration with the correct endpoints and user credentials filled in.</p>
<p>The following may be used as a template for a new INI configuration file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">AWS</span><span class="p">]</span>
<span class="n">profile</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">AWS_Profile_Name</span><span class="o">&gt;</span>

<span class="p">[</span><span class="n">API_GATEWAY</span><span class="p">]</span>
<span class="n">url_template</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span><span class="o">.</span><span class="n">execute</span><span class="o">-</span><span class="n">api</span><span class="o">.</span><span class="p">{</span><span class="n">region</span><span class="p">}</span><span class="o">.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="p">{</span><span class="n">stage</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">resource</span><span class="p">}</span>
<span class="nb">id</span>           <span class="o">=</span> <span class="o">&lt;</span><span class="n">API_Gateway_ID</span><span class="o">&gt;</span>
<span class="n">region</span>       <span class="o">=</span> <span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">2</span>
<span class="n">stage</span>        <span class="o">=</span> <span class="o">&lt;</span><span class="n">API_Gateway_Stage_Name</span><span class="o">&gt;</span>
<span class="n">resource</span>     <span class="o">=</span> <span class="n">request</span>

<span class="p">[</span><span class="n">COGNITO</span><span class="p">]</span>
<span class="n">client_id</span>    <span class="o">=</span> <span class="o">&lt;</span><span class="n">Cognito_Client_ID</span><span class="o">&gt;</span>
<span class="n">username</span>     <span class="o">=</span> <span class="o">&lt;</span><span class="n">Cognito_Username</span><span class="o">&gt;</span>
<span class="n">password</span>     <span class="o">=</span> <span class="o">&lt;</span><span class="n">Cognito_Password</span><span class="o">&gt;</span>
<span class="n">region</span>       <span class="o">=</span> <span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">2</span>

<span class="p">[</span><span class="n">OTHER</span><span class="p">]</span>
<span class="n">log_level</span> <span class="o">=</span> <span class="n">INFO</span>
<span class="n">file_format</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">%(asctime)s</span><span class="s2">] </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(threadName)s</span><span class="s2"> </span><span class="si">%(funcName)s</span><span class="s2"> : </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">cloudwatch_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(funcName)s</span><span class="s1"> : </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
<span class="n">console_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">log_group_name</span> <span class="o">=</span> <span class="s2">&quot;&lt;Cloudwatch_Log_Group_Name&gt;&quot;</span>
<span class="n">log_file_path</span> <span class="o">=</span>
</pre></div>
</div>
<p>Bracketed fields within the template correspond to values which need to be filled
in by an end-user prior to using the <cite>pds-ingress-client</cite> script to transfer
files to PDS. The remaining fields should be left as-is.</p>
<p>To obtain the correct values for <cite>&lt;AWS_Profile_Name&gt;</cite>, <cite>&lt;API_Gateway_ID&gt;</cite>,
<cite>&lt;API_Gateway_Stage_Name&gt;</cite> and <cite>&lt;Cognito_Client_ID&gt;</cite>, <cite>&lt;Cloudwatch_Log_Group_Name&gt;</cite>
contact a PDS Operator.</p>
<p>To obtain values for <cite>&lt;Cognito_Username&gt;</cite> and <cite>&lt;Cognito_Password&gt;</cite>, consult
the section on User Registration within this document.</p>
</div>
<div class="section" id="running-the-client-script">
<h3>Running the Client script<a class="headerlink" href="#running-the-client-script" title="Permalink to this headline">¶</a></h3>
<p>Once the <cite>pds-data-upload-manager</cite> has been installed, you can run <code class="docutils literal notranslate"><span class="pre">pds-ingress-client</span> <span class="pre">--help</span></code>
to get a usage message and ensure the client-side service is properly installed. You can
also consult the <cite>usage_</cite> documentation for more details.</p>
</div>
</div>
<div class="section" id="upgrading-the-service">
<h2>Upgrading the Service<a class="headerlink" href="#upgrading-the-service" title="Permalink to this headline">¶</a></h2>
<p>To check for and install an upgrade to the service, run the following command in
your virtual environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">pds</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">upload</span><span class="o">-</span><span class="n">manager</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An update to an existing virtualenv installation of the PDS DUM Service may fail
if the underlying minimum required Python version has changed. If so, a new
virtual environment should be created using the required version of Python, after
which the latest version of the Service may be installed into it. Consult the
installation instructions above on how to create a new virtual environment.</p>
</div>
</div>
<div class="section" id="configuring-the-server-side-bucket-map">
<h2>Configuring the Server side Bucket Map<a class="headerlink" href="#configuring-the-server-side-bucket-map" title="Permalink to this headline">¶</a></h2>
<p>Once the Server side components of DUM have been deployed to AWS (see <a href="#id7"><span class="problematic" id="id8">terraform_</span></a> section),
how ingested files are routed to S3 buckets is controlled via a “Bucket Map” configuration
file which gets bundled with the “nucleus-dum-ingress-service” lambda function.</p>
<p>The format of the file is a simple <a class="reference external" href="https://yaml.org">YAML</a> format file. An example bucket map is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MAP</span><span class="p">:</span>
  <span class="n">NODES</span><span class="p">:</span>
    <span class="n">ATM</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">ENG</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">GEO</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">IMG</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">NAIF</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">PPI</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">RMS</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">RS</span><span class="p">:</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
    <span class="n">SBN</span><span class="p">:</span>
      <span class="n">gbo</span><span class="o">.</span><span class="n">ast</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">survey</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">staging</span>
      <span class="n">default</span><span class="p">:</span> <span class="n">pds</span><span class="o">-</span><span class="n">nucleus</span><span class="o">-</span><span class="n">dum</span>
</pre></div>
</div>
<p>Within the mapping is are separate entries for each PDS Node which could make
an ingress request via the client script. Within each Node section are one or
more key/value mappings, where keys correspond to an expected path prefix of
a file requested for ingest, and each value is the name of an S3 bucket where the
file should be uploaded to.</p>
<p>In the above example, we can see that a default mapping is configured for all
nodes that instructs the ingress lambda function to route all files to the <code class="docutils literal notranslate"><span class="pre">pds-nucleus-dum</span></code>
bucket. This is the mapping that will be used when no other mapping for a path prefix exists.</p>
<p>Within the <code class="docutils literal notranslate"><span class="pre">SBN</span></code> section, we also see that a mapping from the <code class="docutils literal notranslate"><span class="pre">gbo.ast.catalina.survey</span></code>
path prefix to the <code class="docutils literal notranslate"><span class="pre">pds-nucleus-staging</span></code> bucket is also defined. This means that any
requests file paths that begin with <code class="docutils literal notranslate"><span class="pre">gbo.ast.catalina.survey</span></code> will be routed to the
<code class="docutils literal notranslate"><span class="pre">pds-nucleus-staging</span></code> bucket during upload.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> argument of the <code class="docutils literal notranslate"><span class="pre">pds-ingress-client</span></code> script can be instrumental to ensure
that paths requested for ingress have a prefix that matches one of the mappings expected by
the bucket config. Consult the <a class="reference external" href="../usage/index.html">usage</a> page for the <code class="docutils literal notranslate"><span class="pre">pds-ingress-client</span></code> for more details
on using the <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> argument.</p>
</div>
<p>Should there ever be a need to make modifications to the bucket map used with a
deployment of the DUM service, changes can be made to the file directly from within the
AWS Console Lambda Code Source editor window. Be sure that the function is redeployed after
any updates are made to the bucket map to ensure they take affect for subsequent ingress reqeusts.</p>
</div>
<div class="section" id="adding-users-to-the-aws-cognito-user-pool">
<h2>Adding users to the AWS Cognito User Pool<a class="headerlink" href="#adding-users-to-the-aws-cognito-user-pool" title="Permalink to this headline">¶</a></h2>
<p>Before the client-side script can be used to request ingest of files to PDS Cloud,
a valid user account must exist in the AWS Cognito User Pool deployed with the rest
of the DUM Server side components. Credentials for the user must then be provided in
the INI config used with the <code class="docutils literal notranslate"><span class="pre">pds-ingress-client</span></code> script.</p>
<p>Currently, there are only two ways to configure new users within the User Pool:</p>
<ul class="simple">
<li><p>Specify the list of users to pre-populate the User Pool with via the <cite>.tfvars</cite> file used with a Terraform deployment. See the <a href="#id9"><span class="problematic" id="id10">terraform_</span></a> section for more information on how to configure this.</p></li>
<li><p>Manually add new users via the AWS Admin Console for the Cognito service. More information on how to do so can be found here: <a class="reference external" href="https://docs.aws.amazon.com/cognito/latest/developerguide/how-to-create-user-accounts.html">https://docs.aws.amazon.com/cognito/latest/developerguide/how-to-create-user-accounts.html</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../development/index.html" class="btn btn-neutral float-right" title="👩‍💻 Development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="PDS Data Upload Manager" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2023 California Institute of Technology

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>